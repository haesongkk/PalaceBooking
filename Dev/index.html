<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8">
        <title>Dev Page - 데이터베이스 테이블 뷰어</title>
        <style>
            body {
                font-family: Arial, sans-serif;
                margin: 20px;
                background-color: #f5f5f5;
            }
            .table-container {
                background: white;
                margin: 20px 0;
                border-radius: 8px;
                box-shadow: 0 2px 4px rgba(0,0,0,0.1);
                overflow: hidden;
            }
            .table-header {
                background: #2c3e50;
                color: white;
                padding: 15px;
                font-size: 18px;
                font-weight: bold;
            }
            .table-content {
                padding: 20px;
            }
            .column-info {
                background: #ecf0f1;
                padding: 15px;
                border-radius: 5px;
                margin-bottom: 20px;
            }
            .column-info h3 {
                margin: 0 0 10px 0;
                color: #2c3e50;
            }
            .column-list {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
                gap: 10px;
            }
            .column-item {
                background: white;
                padding: 8px 12px;
                border-radius: 4px;
                border-left: 4px solid #3498db;
                font-family: monospace;
                font-size: 14px;
            }
            .meta-info {
                background: #fff8e1;
                padding: 15px;
                border-radius: 5px;
                margin-bottom: 20px;
                border-left: 4px solid #f39c12;
            }
            .meta-info h3 {
                margin: 0 0 10px 0;
                color: #8e5b0c;
            }
            .meta-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
                gap: 10px;
            }
            .meta-item {
                background: white;
                padding: 8px 12px;
                border-radius: 4px;
                border: 1px solid #f1c40f55;
                font-size: 14px;
            }
            .meta-key {
                font-weight: bold;
                color: #7f8c8d;
                margin-right: 6px;
            }
            .data-info h3 {
                margin: 0 0 15px 0;
                color: #2c3e50;
            }
            .data-table {
                width: 100%;
                border-collapse: collapse;
                margin-top: 10px;
            }
            .data-table th {
                background: #34495e;
                color: white;
                padding: 12px 8px;
                text-align: left;
                font-weight: bold;
            }
            .data-table td {
                padding: 8px;
                border-bottom: 1px solid #ddd;
                font-size: 14px;
            }
            .data-table tr:nth-child(even) {
                background-color: #f8f9fa;
            }
            .data-table tr:hover {
                background-color: #e8f4fd;
            }
            .no-data {
                text-align: center;
                color: #7f8c8d;
                font-style: italic;
                padding: 20px;
            }
            .loading {
                text-align: center;
                color: #7f8c8d;
                padding: 20px;
            }
        </style>
    </head>
    <body>
        <h1>개발자 페이지</h1>
        <div id="loading" class="loading">데이터를 불러오는 중...</div>
        <div id="tables-container"></div>

        <script>
            fetch('/api/dev/tableList')
            .then(response => response.json())
            .then(tableList => {
                if(tableList.error) {
                    alert(tableList.error);
                    return;
                }
                const container = document.getElementById('tables-container');
                tableList.forEach(table => {
                    const tableDiv = document.createElement('div');
                    tableDiv.className = 'table-container';
                    tableDiv.innerHTML = `
                        <div class="table-header">
                            ${table.table_name}
                        </div>
                        <div class="table-content">
                            ${Object.entries(table).map(([key, value]) => `
                                <div class="meta-item">
                                    <span class="meta-key">${key}:</span>
                                    <span>${value}</span>
                                </div>
                            `).join('')}
                            <div class="data-table"></div>
                            
                        </div>
                    `;
                    tableDiv.onclick = () => {
                        tableDiv.classList.toggle('active');
                        if(!tableDiv.classList.contains('active')) {
                            tableDiv.querySelector('.data-table').innerHTML = '';
                            return;
                        }
                        fetch(`/api/dev/table/${table.table_name}`)
                        .then(response => response.json())
                        .then(result => {
                            tableDiv.querySelector('.data-table').innerHTML = `
                                <table class="data-table">
                                    <thead>
                                        ${result.columnList.map(col => `
                                            <th>${col.column_name}(${col.data_type})</th>
                                        `).join('')}
                                    </thead>
                                    <tbody>
                                        ${result.rowList.map(row => `
                                            <tr>${result.columnList.map(col => `<td>${row[col.column_name]}</td>`).join('')}</tr>
                                            `).join('')}
                                    </tbody>
                                </table>
                            `;
                        })
                        .catch(error => {
                            alert(error);
                        });
                    };
                    container.appendChild(tableDiv);

                });
                
                document.getElementById('loading').style.display = 'none';
            })
            .catch(error => {
                alert(error);
            });

        </script>
    </body>
</html>